$(()=>{function e(e){return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function t(e,t){return a=>t[a[e]]}const a={Sex:t("SEX",{1:"Male",2:"Female"}),"Age (fine)":function(e){const t=parseInt(e.AGE,10);if(t>73)return"73+";const a=Math.round(t-(t-18)%8);return`${a}-${a+7}`},"Wealth Class":function(e){const t=parseFloat(e.NETWORTH);return t<0?"1: <0":t<4e4?"2: 0-40k":t<1e5?"3: 40k-100k":t<1e6?"4: 100k-1M":t<5e6?"5: 1M-5M (HNW)":t<3e7?"6: 5M-30M (VHNW)":"7: >30M (UHNW)"},"Income Class":function(e){const t=parseFloat(e.INCOME);return t<=2e4?"2: 0-20k":t<=39e3?"3: 20k-39k":t<=83e3?"4: 39k-83k":t<=17e4?"5: 83k-170k":t<=5e5?"6: 170k-500k":"8: >500k"},"Age (FRB)":t("AGECL",{1:"35 and under",2:"35-44",3:"45-54",4:"55-64",5:"65-74",6:"74 and over"}),"Education Level":t("EDCL",{1:"1: no high school diploma",2:"2: high school diploma",3:"3: some college",4:"4: bachelor's degree or higher"}),Race:t("RACE",{1:"white non-Hispanic",2:"black/African-American",3:"Hispanic",4:"Asian",5:"other"}),Marriage:t("MARRIED",{1:"married/cohabitating",2:"not married/cohabitating"}),"Has Children":e=>"0"!==e.KIDS?"Yes":"No","No. of Children":e=>e.KIDS,"Is Working":e=>"0"!==e.LF?"Yes":"No","Work Type":t("OCCAT1",{1:"employed",2:"self-employed",3:"retired/disabled/student/homemaker",4:"other not working"}),Occupation:t("OCCAT2",{1:"managerial/professional",2:"technical/sales/services",3:"other",4:"not working"})},o={Income:e=>e.INCOME,"Wage Income":e=>e.WAGEINC,"Food Spending":e=>parseFloat(e.FOODHOME)+parseFloat(e.FOODAWAY)+parseFloat(e.FOODDELV),"Food Spending to Income":e=>(parseFloat(e.FOODHOME)+parseFloat(e.FOODAWAY)+parseFloat(e.FOODDELV))/parseFloat(e.INCOME),"Home Food Ratio":e=>parseFloat(e.FOODHOME)/(parseFloat(e.FOODHOME)+parseFloat(e.FOODAWAY)+parseFloat(e.FOODDELV)),"Net Worth":e=>e.NETWORTH,"Net Worth excl. EduLoans":e=>parseFloat(e.NETWORTH)+parseFloat(e.EDN_INST),"Net Worth excl. Vehicles":e=>parseFloat(e.NETWORTH)-parseFloat(e.VEHIC),"Directly Held Mutual Funds":e=>e.NMMF,"Retirement Accounts":e=>e.RETQLIQ,"Primary Residence":e=>e.HOUSES,"Liquid Assets":e=>e.LIQ,"Total Assets":e=>e.ASSET,"Credit Card Debt":e=>e.CCBAL,"Education Loans":e=>e.EDN_INST,"Residential Loans":e=>e.MRTHEL,"Leverage Ratio":e=>e.LEVRATIO,"Total Debt to Income":e=>e.DEBT2INC,"Total Debt":e=>e.DEBT,"Debt Payments to Income":e=>e.PIRTOTAL},r=Object.assign({},a,o),i=$.extend($.pivotUtilities.renderers,$.pivotUtilities.plotly_renderers),s=(t=>({Count:function(){return(a,o,r)=>({count:0,push(e){this.count+=parseFloat(e[t])},value(){return this.count},format:t=>Number.isNaN(t)?t:e(t)})},"Sample Count":function(){return(e,t,a)=>({count:0,push(e){this.count+=1},value(){return this.count/5},format:e=>Number.isNaN(e)?e:function(e){return e.toLocaleString("en-US",{maximumFractionDigits:0})}(e)})},"Sum of":function([a]){return(o,r,i)=>({sum:0,push(e){this.sum+=parseFloat(e[t])*parseFloat(e[a])},value(){return this.sum},format:t=>Number.isNaN(t)?t:e(t),numInputs:1})},"Average of":function([a]){return(o,r,i)=>({weightedSum:0,sumOfWeights:0,weightedMean:0,push(e){const o=parseFloat(e[a]),r=parseFloat(e[t]);Number.isNaN(o)||Number.isNaN(r)||(this.sumOfWeights+=r,this.weightedSum+=r*o,this.weightedMean=this.weightedSum/this.sumOfWeights)},value(){return this.weightedMean},format:t=>Number.isNaN(t)?t:e(t),numInputs:1})},"Median of":function([a]){return(o,r,i)=>({sumOfWeights:0,vals:[],push(e){const o=parseFloat(e[a]),r=parseFloat(e[t]);this.sumOfWeights+=r,this.vals.push([o,r])},value(){let e=0;const t=.5*this.sumOfWeights;this.vals.sort((e,t)=>t[0]-e[0]);for(const[a,o]of this.vals)if((e+=o)>=t)return a;return this.vals[this.vals.length-1][0]},format:t=>Number.isNaN(t)?t:e(t),numInputs:1})},"Maximum of":$.pivotUtilities.aggregators.Maximum,"Minimum of":$.pivotUtilities.aggregators.Minimum}))("WGT"),n=$.pivotUtilities.aggregatorTemplates;$.extend(s,{"Fraction of Total":n.fractionOf(s.Count,"total",e),"Fraction of Rows":n.fractionOf(s.Count,"row",e),"Fraction of Columns":n.fractionOf(s.Count,"col",e)});JSZipUtils.getBinaryContent("SCFP2016.zip",(e,t)=>{if(e)throw $("#loading").toggleClass("alert-primary alert-danger"),$("#loading").html('<p class="lead"> Download failed. Please try reloading this page at a later time.</p>'),e;JSZip.loadAsync(t).then(e=>{e.file("SCFP2016.csv").async("string").then(e=>{Papa.parse(e,{skipEmptyLines:!0,header:!0,complete:e=>{$("#loading").hide(),$("#output").pivotUI(e.data,(e=>({aggregators:s,hiddenFromAggregators:Object.keys(a),hiddenFromDragDrop:Object.keys(o),hiddenAttributes:e,renderers:i,rendererOptions:{table:{rowTotals:!1,colTotals:!1}},derivedAttributes:r,cols:["Age (fine)"],rows:["Education Level"],aggregatorName:"Median of",rendererName:"Line Chart",vals:["Wage Income"],rowOrder:"key_a_to_z",colOrder:"key_a_to_z"}))(e.meta.fields))}})})})})});